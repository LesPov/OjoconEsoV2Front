<div class="user-summary-container" *ngIf="user && profile; else loadingTemplate">
    <!-- Botón para volver a la lista de usuarios -->
    <button type="button" class="back-btn" (click)="goBack()">
      <i class="bx bx-left-arrow-alt"></i>
    </button>
  
    <div class="card">
      <ul class="dropdown-list">
        <!-- Sección: Información del Usuario (Cuenta) -->
        <li>
          <details #userDetails>
            <summary>Usuario</summary>
            <form #userForm="ngForm" (ngSubmit)="updateUser()">
              <div class="group image-preview-group">
                <div class="image-container">
                  <img [src]="getImageUrl(user.userProfile.profilePicture)"
                       alt="Imagen de {{ user.username }}" class="profile-img">
                </div>
                <label class="btn-upload">
                  <i class='bx bx-image-add'></i>
                  <input type="file" id="profilePicture" (change)="onFileSelected($event)" style="display: none;">
                </label>
              </div>
              <div class="group">
                <label class="lbl" for="id">ID</label>
                <input type="text" id="id" class="input" [value]="user.id" readonly>
              </div>
              <div class="group">
                <label class="lbl" for="username">Nombre</label>
                <input type="text" id="username" class="input" [(ngModel)]="user.username"
                       (ngModelChange)="checkUserModified()" name="username" placeholder="Ingrese su nombre">
              </div>
              <div class="group">
                <label class="lbl" for="email">Email</label>
                <input type="email" id="email" class="input" [(ngModel)]="user.email"
                       (ngModelChange)="checkUserModified()" name="email" placeholder="Ingrese su email">
              </div>
              <div class="group">
                <label class="lbl" for="phoneNumber">Teléfono</label>
                <input type="text" id="phoneNumber" class="input" [(ngModel)]="user.phoneNumber"
                       (ngModelChange)="checkUserModified()" name="phoneNumber" placeholder="Ingrese su teléfono">
              </div>
              <div class="group">
                <label class="lbl" for="rol">Rol</label>
                <select id="rol" class="input" [(ngModel)]="user.rol"
                        (ngModelChange)="checkUserModified()" name="rol" required>
                  <option value="">Seleccione</option>
                  <option *ngFor="let r of roles" [value]="r">{{ r }}</option>
                </select>
              </div>
              <button type="submit" class="btn" [disabled]="!isModified">Actualizar Perfil</button>
            </form>
          </details>
        </li>
  
        <!-- Sección: Información del Perfil (Datos Personales) -->
        <li>
          <details #profileDetails>
            <summary>Perfil</summary>
            <form #profileForm="ngForm" (ngSubmit)="updateProfileData()">
              <div class="group">
                <label class="lbl" for="firstName">Nombre</label>
                <input type="text" id="firstName" class="input" [(ngModel)]="profile.firstName"
                       (ngModelChange)="checkProfileModified()" name="firstName" required>
              </div>
              <div class="group">
                <label class="lbl" for="lastName">Apellido</label>
                <input type="text" id="lastName" class="input" [(ngModel)]="profile.lastName"
                       (ngModelChange)="checkProfileModified()" name="lastName" required>
              </div>
              <div class="group">
                <label class="lbl" for="identificationType">Tipo de Identificación</label>
                <input type="text" id="identificationType" class="input"
                       [(ngModel)]="profile.identificationType" (ngModelChange)="checkProfileModified()"
                       name="identificationType" required>
              </div>
              <div class="group">
                <label class="lbl" for="identificationNumber">Número de Identificación</label>
                <input type="text" id="identificationNumber" class="input"
                       [(ngModel)]="profile.identificationNumber" (ngModelChange)="checkProfileModified()"
                       name="identificationNumber" required>
              </div>
              <div class="group">
                <label class="lbl" for="direccion">Dirección</label>
                <input type="text" id="direccion" class="input" [(ngModel)]="profile.direccion"
                       (ngModelChange)="checkProfileModified()" name="direccion" required>
              </div>
              <div class="group">
                <label class="lbl" for="biography">Biografía</label>
                <textarea id="biography" class="input" rows="3" [(ngModel)]="profile.biography"
                          (ngModelChange)="checkProfileModified()" name="biography"></textarea>
              </div>
              <div class="group">
                <label class="lbl" for="birthDate">Fecha de Nacimiento</label>
                <input type="date" id="birthDate" class="input" [(ngModel)]="profile.birthDate"
                       (ngModelChange)="checkProfileModified()" name="birthDate">
              </div>
              <div class="group">
                <label class="lbl" for="gender">Género</label>
                <select id="gender" class="input" [(ngModel)]="profile.gender"
                        (ngModelChange)="checkProfileModified()" name="gender" required>
                  <option value="Mujer">Mujer</option>
                  <option value="Hombre">Hombre</option>
                  <option value="Otro género">Otro género</option>
                  <option value="Prefiero no declarar">Prefiero no declarar</option>
                </select>
              </div>
              <div class="group">
                <label class="lbl" for="campiamigo">Campiamigo</label>
                <input type="checkbox" id="campiamigo" [(ngModel)]="profile.campiamigo"
                       (ngModelChange)="checkProfileModified()" name="campiamigo">
              </div>
              <button type="submit" class="btn" [disabled]="!isProfileModified">Actualizar Perfil</button>
            </form>
          </details>
        </li>
      </ul>
      <br>
  
      <!-- Sección: Información Sociodemográfica y Familia (solo para campesino) -->
      <div *ngIf="user?.rol?.toLowerCase() === 'campesino'">
        <ul class="dropdown-list content-campesino">
          <li>
            <details #socioDetails>
              <summary>Sociodemográfica</summary>
              <ng-container *ngIf="socioData; else noSocioData">
                <form #socioForm="ngForm" (ngSubmit)="updateSocioData()">
                  <div class="group">
                    <label class="lbl" for="residenceYears">Años de Residencia</label>
                    <input type="number" id="residenceYears" class="input"
                           [(ngModel)]="socioData.residenceYears" (ngModelChange)="checkSocioModified()"
                           name="residenceYears">
                  </div>
                  <div class="group">
                    <label class="lbl" for="residenceMonths">Meses de Residencia</label>
                    <input type="number" id="residenceMonths" class="input"
                           [(ngModel)]="socioData.residenceMonths" (ngModelChange)="checkSocioModified()"
                           name="residenceMonths">
                  </div>
                  <div class="group">
                    <label class="lbl" for="selfIdentification">Autoidentificación</label>
                    <select id="selfIdentification" class="input"
                            [(ngModel)]="socioData.selfIdentification" (ngModelChange)="checkSocioModified()"
                            name="selfIdentification">
                      <option value="Campesino(a)">Campesino(a)</option>
                      <option value="Trabajador(a) rural">Trabajador(a) rural</option>
                      <option value="Habitante rural">Habitante rural</option>
                      <option value="Otro">Otro</option>
                    </select>
                  </div>
                  <div class="group" *ngIf="socioData.selfIdentification === 'Otro'">
                    <label class="lbl" for="otherIdentification">Especificar</label>
                    <input type="text" id="otherIdentification" class="input"
                           [(ngModel)]="socioData.otherIdentification" (ngModelChange)="checkSocioModified()"
                           name="otherIdentification">
                  </div>
                  <div class="group">
                    <label class="lbl" for="ethnicGroup">Grupo Étnico</label>
                    <select id="ethnicGroup" class="input"
                            [(ngModel)]="socioData.ethnicGroup" (ngModelChange)="checkSocioModified()"
                            name="ethnicGroup">
                      <option value="Indígena">Indígena</option>
                      <option value="Afrocolombiano">Afrocolombiano</option>
                      <option value="Raizales">Raizales</option>
                      <option value="ROM o gitano">ROM o gitano</option>
                      <option value="Ninguno">Ninguno</option>
                    </select>
                  </div>
                  <div class="group" *ngIf="socioData.ethnicGroup !== 'Ninguno'">
                    <label class="lbl" for="ethnicGroupDetail">Detalle Étnico</label>
                    <input type="text" id="ethnicGroupDetail" class="input"
                           [(ngModel)]="socioData.ethnicGroupDetail" (ngModelChange)="checkSocioModified()"
                           name="ethnicGroupDetail">
                  </div>
                  <div class="group">
                    <label class="lbl" for="hasDisability">¿Tiene Discapacidad?</label>
                    <select id="hasDisability" class="input"
                            [(ngModel)]="socioData.hasDisability" (ngModelChange)="checkSocioModified()"
                            name="hasDisability">
                      <option [ngValue]="true">Sí</option>
                      <option [ngValue]="false">No</option>
                    </select>
                  </div>
                  <div class="group" *ngIf="socioData.hasDisability">
                    <label class="lbl" for="disabilityDetail">Detalle Discapacidad</label>
                    <input type="text" id="disabilityDetail" class="input"
                           [(ngModel)]="socioData.disabilityDetail" (ngModelChange)="checkSocioModified()"
                           name="disabilityDetail">
                  </div>
                  <div class="group">
                    <label class="lbl" for="conflictVictim">¿Víctima del Conflicto?</label>
                    <select id="conflictVictim" class="input"
                            [(ngModel)]="socioData.conflictVictim" (ngModelChange)="checkSocioModified()"
                            name="conflictVictim">
                      <option [ngValue]="true">Sí</option>
                      <option [ngValue]="false">No</option>
                    </select>
                  </div>
                  <div class="group">
                    <label class="lbl" for="educationLevel">Nivel Educativo</label>
                    <select id="educationLevel" class="input"
                            [(ngModel)]="socioData.educationLevel" (ngModelChange)="checkSocioModified()"
                            name="educationLevel">
                      <option value="Ninguna">Ninguna</option>
                      <option value="Primaria">Primaria</option>
                      <option value="Secundaria">Secundaria</option>
                      <option value="Técnico o Tecnológico">Técnico o Tecnológico</option>
                      <option value="Profesional">Profesional</option>
                      <option value="Posgrado">Posgrado</option>
                    </select>
                  </div>
                  <button type="submit" class="btn" [disabled]="!isSocioModified">Actualizar Información Sociodemográfica</button>
                </form>
              </ng-container>
              <ng-template #noSocioData>
                <p>No se encontró información sociodemográfica.</p>
                <button type="button" class="btn" (click)="loadSocioData()">Refrescar Información</button>
              </ng-template>
            </details>
          </li>
          <!-- Sección: Familia u otras (solo para campesino) -->
          <li>
            <details>
              <summary>Familia</summary>
              <div class="content">
                Contenido correspondiente a la opción Familia.
              </div>
            </details>
          </li>
        </ul>
      </div>
    </div>
  </div>
  
  <ng-template #loadingTemplate>
    <div class="loading">Cargando información...</div>
    <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>
  </ng-template>
  